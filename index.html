<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in to Portal</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10a37f">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJhMTAgMTAgMCAxIDAgMTAgMTBjMC0uMzkgMC0uMzktLjA2LS43OC0uMzYtMS45Mi0xLjQxLTMuNjEtMi45NC00Ljc2YTE0IDE0IDAgMCAwLTcuNTYgMEMxMCA0LjYxIDkuMDEgNi4zIDguNjUgOC4yMiA4LjU5IDguNjEgOC41OSA4LjYxIDguNjUgOWExMCAxMCAwIDAgMCAzLjM1LTciIGZpbGw9IiMxMGEzN2YiLz4KPC9zdmc+">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="advanced-features.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-md5/0.7.3/md5.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <span class="logo-text">Portal</span>
                </div>
                
                <div class="header-actions">
                    <!-- AI Security Status Indicator -->
                    <div class="security-status" id="securityStatus" title="AI Security Monitor">
                        <i class="fas fa-shield-alt"></i>
                        <span class="status-dot"></span>
                    </div>
                    
                    <!-- Smart Search Button -->
                    <button class="search-button" id="searchButton" title="Intelligent Search">
                        <i class="fas fa-search"></i>
                    </button>
                    
                    <!-- Notifications Button -->
                    <button class="notifications-button" id="notificationsButton" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                    </button>
                    
                    <!-- Analytics Button -->
                    <button class="analytics-button" id="analyticsButton" title="Analytics Dashboard">
                        <i class="fas fa-chart-line"></i>
                    </button>
                    
                    <!-- File Manager Link -->
                    <a href="file-manager.html" class="nav-link" title="File Manager">
                        <i class="fas fa-file-alt"></i>
                    </a>
                    
                    <!-- Test Storage Link -->
                    <a href="test-storage.html" class="nav-link" title="Test Storage">
                        <i class="fas fa-vial"></i>
                    </a>
                    
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="auth-container">
                <div class="auth-card">
                    <!-- Welcome Section -->
                    <div class="welcome-section">
                        <h1 id="welcomeTitle">Welcome back</h1>
                        <p id="welcomeSubtitle">Sign in to your account to continue</p>
                    </div>

                    <!-- Login Form -->
                    <div class="form-section" id="loginForm">
                        <form id="loginFormElement" class="auth-form">
                            <div class="form-group">
                                <label for="loginEmail">Email address</label>
                                <input 
                                    type="email" 
                                    id="loginEmail" 
                                    placeholder="Enter your email"
                                    required
                                    autocomplete="email"
                                >
                            </div>

                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <div class="password-input">
                                    <input 
                                        type="password" 
                                        id="loginPassword" 
                                        placeholder="Enter your password"
                                        required
                                        autocomplete="current-password"
                                    >
                                    <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                                        <i class="far fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="link-button" onclick="showForgotPassword()">
                                    Forgot your password?
                                </button>
                            </div>

                            <button type="submit" class="submit-button">
                                <span>Continue</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </form>

                        <div class="form-footer">
                            <p>Don't have an account? <button type="button" class="link-button" onclick="showRegisterForm()">Sign up</button></p>
                        </div>
                    </div>

                    <!-- Register Form -->
                    <div class="form-section hidden" id="registerForm">
                        <form id="registerFormElement" class="auth-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="registerUsername">Username</label>
                                    <input 
                                        type="text" 
                                        id="registerUsername" 
                                        placeholder="Choose a username"
                                        required
                                        autocomplete="username"
                                    >
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="registerEmail">Email address</label>
                                <input 
                                    type="email" 
                                    id="registerEmail" 
                                    placeholder="Enter your email"
                                    required
                                    autocomplete="email"
                                >
                            </div>

                            <div class="form-group">
                                <label for="registerMobile">Phone number</label>
                                <input 
                                    type="tel" 
                                    id="registerMobile" 
                                    placeholder="Enter your phone number"
                                    required
                                    maxlength="10"
                                    autocomplete="tel"
                                >
                            </div>

                            <div class="form-group">
                                <label for="registerPassword">Password</label>
                                <div class="password-input">
                                    <input 
                                        type="password" 
                                        id="registerPassword" 
                                        placeholder="Create a password"
                                        required
                                        autocomplete="new-password"
                                    >
                                    <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
                                        <i class="far fa-eye"></i>
                                    </button>
                                </div>
                                <div class="password-strength">
                                    <div class="strength-bar" id="strengthBar"></div>
                                    <span class="strength-text" id="strengthText">Password strength</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Confirm password</label>
                                <div class="password-input">
                                    <input 
                                        type="password" 
                                        id="confirmPassword" 
                                        placeholder="Confirm your password"
                                        required
                                        autocomplete="new-password"
                                    >
                                    <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                                        <i class="far fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <button type="submit" class="submit-button">
                                <span>Create account</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </form>

                        <div class="form-footer">
                            <p>Already have an account? <button type="button" class="link-button" onclick="showLoginForm()">Sign in</button></p>
                        </div>
                    </div>

                    <!-- Forgot Password Form -->
                    <div class="form-section hidden" id="forgotPasswordForm">
                        <form id="forgotPasswordFormElement" class="auth-form">
                            <div class="form-group">
                                <label for="forgotEmail">Email address</label>
                                <input 
                                    type="email" 
                                    id="forgotEmail" 
                                    placeholder="Enter your email"
                                    required
                                    autocomplete="email"
                                >
                                <p class="form-help">We'll send you a link to reset your password</p>
                            </div>

                            <button type="submit" class="submit-button">
                                <span>Send reset link</span>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </form>

                        <div class="form-footer">
                            <p><button type="button" class="link-button" onclick="showLoginForm()">← Back to sign in</button></p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Email Verification Modal -->
        <div class="modal-overlay hidden" id="emailVerificationModal">
            <div class="modal">
                <div class="modal-header">
                    <h3>Verify your email</h3>
                    <button class="modal-close" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <p>We've sent a 6-digit verification code to your email address. Please enter it below:</p>
                    <div class="verification-input">
                        <input type="text" id="verificationCode" placeholder="000000" maxlength="6" autocomplete="one-time-code">
                    </div>
                    <div class="modal-actions">
                        <button class="secondary-button" onclick="closeModal()">Cancel</button>
                        <button class="primary-button" onclick="verifyEmail()">Verify</button>
                    </div>
                    <p class="modal-help">Didn't receive the code? <button type="button" class="link-button" onclick="resendVerification()">Resend</button></p>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
        
        <!-- Advanced Features Overlays -->
        <!-- Search Overlay -->
        <div class="search-overlay hidden" id="searchOverlay">
            <div class="search-container">
                <div class="search-input-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search anything..." autocomplete="off">
                    <button class="search-close" onclick="advancedFeatures.intelligentSearch.hideSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="search-suggestions" id="searchSuggestions"></div>
                <div class="search-results" id="searchResults"></div>
            </div>
        </div>

        <!-- Notifications Panel -->
        <div class="notifications-panel hidden" id="notificationsPanel">
            <div class="notifications-header">
                <h3>Notifications</h3>
                <button class="notifications-close" onclick="advancedFeatures.realtimeNotifications.hideNotifications()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notifications-content" id="notificationsContent">
                <!-- Notifications will be populated here -->
            </div>
        </div>

        <!-- Analytics Dashboard Modal -->
        <div class="modal-overlay hidden" id="analyticsModal">
            <div class="modal analytics-modal">
                <div class="modal-header">
                    <h3>Analytics Dashboard</h3>
                    <button class="modal-close" onclick="advancedFeatures.analytics.hideAnalytics()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content analytics-content" id="analyticsContent">
                    <!-- Analytics charts will be populated here -->
                </div>
            </div>
        </div>

        <!-- Smart Onboarding Tour -->
        <div class="onboarding-overlay hidden" id="onboardingOverlay">
            <div class="onboarding-tooltip" id="onboardingTooltip">
                <div class="tooltip-content">
                    <h4 id="tooltipTitle">Welcome!</h4>
                    <p id="tooltipDescription">Let's get you started with a quick tour.</p>
                </div>
                <div class="tooltip-actions">
                    <button class="skip-tour" onclick="advancedFeatures.smartOnboarding.skipTour()">Skip</button>
                    <button class="next-step" onclick="advancedFeatures.smartOnboarding.nextStep()">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Scripts -->
    <script src="file-storage.js"></script>
    <script src="script.js"></script>
    
    <!-- Advanced Features Scripts -->
    <script src="advanced-features.js"></script>
    <script src="advanced-ui-features.js"></script>
    <script src="advanced-analytics.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Show update available notification
                                    if (window.advancedFeatures) {
                                        window.advancedFeatures.realtimeNotifications.show(
                                            'App Update Available',
                                            'A new version is ready. Refresh to update.',
                                            'info',
                                            () => window.location.reload()
                                        );
                                    }
                                }
                            });
                        });
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Initialize Advanced Features when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize advanced features
            if (typeof AdvancedFeatures !== 'undefined') {
                window.advancedFeatures = new AdvancedFeatures();
                
                // Start onboarding for new users
                if (!localStorage.getItem('onboarding_completed')) {
                    setTimeout(() => {
                        window.advancedFeatures.smartOnboarding.startTour();
                    }, 1000);
                }
            }
        });
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install notification after 30 seconds if not installed
            setTimeout(() => {
                if (window.advancedFeatures && deferredPrompt) {
                    window.advancedFeatures.realtimeNotifications.show(
                        'Install Portal App',
                        'Install Portal as an app for a better experience',
                        'info',
                        () => {
                            deferredPrompt.prompt();
                            deferredPrompt.userChoice.then((choiceResult) => {
                                if (choiceResult.outcome === 'accepted') {
                                    console.log('User accepted the install prompt');
                                }
                                deferredPrompt = null;
                            });
                        }
                    );
                }
            }, 30000);
        });
    </script>
</body>
</html>
